---
import Layout from '../layouts/Layout.astro';
---

<Layout title="常用網站">
    <div class="container mx-auto px-4 py-8 bg-gray-900 text-white min-h-screen">
        <div id="sites-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
            <!-- 網站按鈕將在此動態生成 -->
        </div>
    </div>

    <script is:inline>
        async function loadWebsites() {
            try {
                const response = await fetch('/websites.json');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const container = document.getElementById('sites-container');

                data.categories.forEach((category) => {
                    const categorySection = document.createElement('div');
                    categorySection.className = 'category bg-gray-800 rounded-lg p-4';

                    const categoryTitle = document.createElement('h2');
                    categoryTitle.className = 'text-xl font-bold mb-4 text-white';
                    categoryTitle.textContent = category.name;
                    categorySection.appendChild(categoryTitle);

                    const siteGrid = document.createElement('div');
                    siteGrid.className = 'grid grid-cols-2 gap-2';

                    category.sites.forEach((site) => {
                        const siteButton = document.createElement('button');
                        siteButton.className = `
                        flex items-center space-x-2 
                        bg-gray-700 text-white 
                        border border-gray-600 rounded-lg p-2 
                        hover:bg-gray-600 transition 
                        text-sm w-full
                    `;
                        siteButton.innerHTML = `
                        <span>${site.icon ?? ''}</span>
                        <span>${site.name}</span>
                    `;

                        siteButton.addEventListener('click', () => {
                            window.open(site.url, '_blank');
                        });

                        siteGrid.appendChild(siteButton);
                    });

                    categorySection.appendChild(siteGrid);
                    container.appendChild(categorySection);
                });
            } catch (error) {
                console.error('載入網站時發生錯誤:', error);

                const container = document.getElementById('sites-container');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-800 text-white p-4 rounded-lg';
                errorDiv.textContent = `載入網站時發生錯誤：${error.message}`;
                container.appendChild(errorDiv);
            }
        }

        document.addEventListener('DOMContentLoaded', loadWebsites);
    </script>
</Layout>
